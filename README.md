# todo-service
TODO-приложение, разработанное с применением микросервисной архитектуры.

### Архитектура проекта
1. **[todo_core/](./todo_core/)** - основной микросервис на Python Django, отвечающий за работу с пользователями, задачами, категориями и отправкой уведомлений о начале выполнения задачи (Celery)
2. **[comments/](./comments/)** - микросервис на FastAPI, отвечающий за работу с комментариями к задачам
3. **[bot/](./bot/)** - микросервис на Aiogram/aiogram_dialog, отвечающий за работу Telegram-бота (клиентская часть)

#### Работа с данными
1. **Основная база данных** - PostgreSQL. С ней взаимодействуют два микросервиса - **todo_core** и **comments**
2. **Кэширование** - Redis. При создании комментариев **comments** сначала обращается в кэш, если там отсутствуют данные о необходимой задаче, то он делает запрос к основной базе данных
3. **REST API** - **comments** и **todo_core** реализуют CRUD интерфейсы для работы с данными

*У **bot** нет прямого доступа к Базе Данных! Он общается с **todo_core** и **comments** для выполнения операций с данными*

### Авторизация запросов
Перед выполнением запросов к REST API необходимо получить JWT-токен, отправив POST-запрос на http://todo-core:8000/api/token

Использование JWT-токена в заголовке *Authorization* требуется от всех внешних запросов, кроме внутренних от микросервисов (они находятся в белом списке)

### Запуск сервиса
В первую очередь следует указать все необходимые переменные окружения в файле .env:

```bash
mv .env.example .env
cat .env
nano .env
```

Запуск всех микросервисов осуществляется автоматически с помощью docker-compose файла:

```bash
# Продакш-образ
docker-compose -f docker-compose.yml up --build

# Для разработки (todo_core и comments будут перезапускаться автоматически при сохранении файлов)
# !Однако микросервис bot требует ручной перезагрузки

docker-compose -f docker-compose.yml -f docker-compose.dev.yml up --build
```

*При обновлении файлов poetry.lock и pyproject.yml необходимо производить повторный билд:*

```bash
docker-compose -f docker-compose.yml build
```
